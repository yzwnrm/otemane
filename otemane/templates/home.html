{% extends "base.html" %}
{% load static %}
{% block content %}
<body>
<div class="d-flex align-items-center" style="gap: 10px; margin-top: 10px;">
  <div class="child-icon" style="font-size: 2rem;">{{ selected_child.icon }}</div>
    <form method="post" action="{% url 'app:set_child' %}">
      {% csrf_token %}
      <select id="childSelect" name="child_id" onchange="this.form.submit()">
      {% for child in children %}
        <option value="{{ child.id }}" {% if child == selected_child %}selected{% endif %}>
          {{ child.child_name }}
        </option>
      {% endfor %}
      </select>
    </form>
  </div>
</div>
  <div class="container">
    <div class="text-center my-4">
      <div class="d-flex justify-content-center align-items-center">
        <button id="prevMonth" >◁ 前月</button>
        <h2 id="monthTitle" class="mb-0"></h2>
        <button id="nextMonth">翌月 ▷</button>
      </div>

      <!-- ここはお金とおかしだけ -->
      <h3 id="moneyTotal" class="mt-3">おかね💰 0 えん</h3>
      <h3 id="sweetsTotal" class="mt-3">おかし🍩 0 こ</h3>
      <br><br>      <!-- リアクションまとめ -->
      <div class="d-flex justify-content-center align-items-center flex-wrap gap-3 mt-3">
        <h4 id="heartTotal">💗 0</h4>
        <h4 id="smileTotal">😊 0</h4>
        <h4 id="goodTotal">👍 0</h4>
        <h4 id="flowerTotal">🌸 0</h4>
        <h4 id="niceTotal">😎 0</h4>
      </div>

      <!-- モーダルボタン -->
      <button id="openModal" class="open-modal">くわしくみる</button>

      <!-- モーダル -->
      <div id="myModal" class="modal" style="display:none;">
        <div class="modal-content">
          <span id="closeModal" class="close-modal">&times;</span>
          <div id="helpRecordsContainer"></div>
          
          {% if monthly_records %}
            {% for record in monthly_records %}
              <div class="d-flex align-items-center mb-2" style="display: flex; align-items: center;">
                <div class="me-3">{{ record.date }}</div>
                <div class="me-3">{{ record.help }}</div>
                <div class="me-3">
                    {% for reward in record.reward %}
                      {% if reward.type == "おかね" %}
                        {{ reward.prize }}えん
                      {% elif reward.type == "おかし" %}
                        おかし1こ
                      {% else %}
                        {{ reward.type }}：{{ reward.detail }}
                      {% endif %}
                    {% endfor %}
                </div>
                <div>{{ record.reaction }}</div>
              </div>
              {% endfor %}
          {% else %}
            <div class="text-muted">今月の記録はありません。</div>
          {% endif %}
        </div>
      </div>

    </div>
  </div>


  <script>
    window.monthlyRewards = {{ monthly_rewards|safe }};
    window.monthlyRecords = {{ monthly_records|safe }};
    window.currentMonth = "{{ current_month }}";
  </script>

  <script src="{% static 'js/home.js' %}"></script>
  <script src="{% static 'js/home_reward.js' %}"></script>
</body>
{% endblock %}
